<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Planner</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; }
        header { background-color: #333; color: white; padding: 10px 0; text-align: center; }
        #content, #userSelection { padding: 20px; }
        .hidden { display: none; }
        button { margin: 5px; padding: 10px 20px; cursor: pointer; }
        .task, .user { background-color: white; padding: 10px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <header>
        <h1>Task Planner</h1>
    </header>
    <div id="userSelection">
        <h2>Select User</h2>
        <ul id="userSelectList"></ul>
        <button onclick="deleteData()">Clear data</button>
    </div>
    <div id="content" class="hidden">
        <button onclick="goBack()">INAPOI LA UTILIZATORI</button>
        <section id="admin" class="hidden">
            <h2>Admin Panel</h2>
            <h3>Create account</h3>
            <input type="text" id="newUserName" placeholder="User Name">
            <select id="userRole">
                <option value="manager">Manager</option>
                <option value="executant">Executant</option>
            </select>
            <button onclick="addUser()">Add User</button>
            <h3>Assign Manager to Executant</h3>
            <div>
                <label> Executants: </label>
                <select id="executantList"></select>
            </div>
            <div>
                <label> Managers: </label>
                <select id="managerList"></select>
            </div>
            <button onclick="assignManager()">Assign Manager</button>
            <h3>Users List</h3>
            <ul id="userList"></ul>
        </section>
        <section id="manager" class="hidden">
            <h2>Manager Panel</h2>
            <input type="text" id="taskDescription" placeholder="Task Description">
            <button onclick="createTask()">Create Task</button>
            <h3>Tasks (OPEN)</h3>
            <ul id="openTaskList"></ul>
            <h3>Tasks (PENDING)</h3>
            <ul id="pendingTaskList"></ul>
            <h3>Tasks (COMPLETED)</h3>
            <ul id="completedTaskList"></ul>
            <h3>Tasks (CLOSED)</h3>
            <ul id="closedTaskList"></ul>
            <h3>Assign Task to Executant</h3>
            <select id="assignTask"></select>
            <select id="assignExecutant"></select>
            <button onclick="assignTask()">Assign Task</button>
        </section>
        <section id="executant" class="hidden">
            <h2>Executant Panel</h2>
            <h3>Pending tasks</h3>
            <ul id="userPendingTasks"></ul>
            <h3>Past tasks</h3>
            <ul id="userPastTasks"></ul>
        </section>
    </div>

    <script>
        let users = [{ name: 'Admin', role: 'admin' }];
        let tasks = [];
        let currentUser = null;

		function saveData() {
			localStorage.setItem('users', JSON.stringify(users));
			localStorage.setItem('tasks', JSON.stringify(tasks));
		}

		function loadData() {
			const savedUsers = localStorage.getItem('users');
			const savedTasks = localStorage.getItem('tasks');

			if (savedUsers) {
				users = JSON.parse(savedUsers);
			}

			if (savedTasks) {
				tasks = JSON.parse(savedTasks);
			}
		}
	
        function deleteData() {
            users = [{ name: 'Admin', role: 'admin' }];
            tasks = [];

            saveData();

            showUserSelection(); 
        }

        function showUserSelection() {
            const userList = document.getElementById('userSelectList');
            userList.innerHTML = '';

            users.forEach((user, index) => {
                userList.innerHTML += `<li class="user">${user.name} - ${user.role} <button onclick="selectUser(${index})">Select</button></li>`;
            });
        }

        function selectUser(index) {
            currentUser = users[index];
            document.getElementById('userSelection').classList.add('hidden');
            document.getElementById('content').classList.remove('hidden');
            showSection(currentUser.role);
        }

        function goBack() {
            document.getElementById('content').classList.add('hidden');
            document.getElementById('userSelection').classList.remove('hidden');
            showUserSelection();
        }

		function updateExecutantDropdown() {
			const dropdown = document.getElementById('assignExecutant');
			dropdown.innerHTML = '';
			
			users.forEach((user, index) => {
				if (user.role === 'executant' && user.manager === currentUser.name) {
					dropdown.innerHTML += `<option value="${index}">${user.name}</option>`;
				}
			});
		}

		function assignTask() {
			const taskIndex = parseInt(document.getElementById('assignTask').value);
			const execIndex = parseInt(document.getElementById('assignExecutant').value);
			
			if (!isNaN(execIndex) && !isNaN(taskIndex)) {
				tasks[taskIndex].assignedTo = users[execIndex].name;
				tasks[taskIndex].status = 'PENDING';
				updateTaskLists();
			}

            saveData();
		}
	
		function showSection(role) {
            console.log("SHOW SELECTION",role);
			document.querySelectorAll('#content section').forEach(section => {
				section.classList.add('hidden');
			});
			
			const section = document.getElementById(role);
			if (section) {
				section.classList.remove('hidden');
			}
			
			
            if(role === "admin") {
                updateAssignLists();
                updateUsersLists();
            } else if (role === 'manager') {
				updateTaskLists();
				updateExecutantDropdown();
			} else if (role === 'executant') {
				updateUserTasks();
			}
		}

        function updateUsersLists()
        {
            const userList = document.getElementById('userList');
            userList.innerHTML = '';

            users.forEach((user, index) => {
                userList.innerHTML += `<li class="user">${user.name} - ${user.role}</li>`;
            });
        }
		function updateTaskLists() {
			const openList = document.getElementById('openTaskList');
            const pendingList = document.getElementById('pendingTaskList');
            const completedList = document.getElementById('completedTaskList');
            const closedList = document.getElementById('closedTaskList');

			const assignTaskDropdown = document.getElementById('assignTask');

			openList.innerHTML = '';
            pendingList.innerHTML = '';
            completedList.innerHTML = '';
            closedList.innerHTML = '';

			assignTaskDropdown.innerHTML = '';
			
			tasks.forEach((task, index) => {
                switch(task.status)
                {
                    case 'OPEN':
                        assignTaskDropdown.innerHTML += `<option value="${index}">${task.description}</option>`;
                        openList.innerHTML += `<li>${task.description} - ${task.status}</li>`;
                        break;
                    case 'PENDING':
                        pendingList.innerHTML += `<li>${task.description} - BY ${task.assignedTo}</li>`; 
                        break;
                    case 'COMPLETED':
                        completedList.innerHTML += `
                        <li>
                                ${task.description} - BY ${task.assignedTo}
                                <button onclick="markTaskClosed(${index})">Mark as Closed</button>
                        </li>`;
                        break;
                    case 'CLOSED':
                        closedList.innerHTML += `<li>${task.description} - BY ${task.assignedTo}</li>`; 
                        break;
                }
			});
		}
	
        function updateUserTasks() {
            const userPendingTasks = document.getElementById('userPendingTasks');
            const userPastTasks = document.getElementById('userPastTasks');

            userPendingTasks.innerHTML = '';
            userPastTasks.innerHTML = '';

            tasks.forEach((task, index) => {
                if (task.assignedTo === currentUser.name) {
                    if(task.status === 'PENDING')
                    {
                        userPendingTasks.innerHTML += `
                        <li>
                            ${task.description} - ${task.status}
                            <button onclick="markTaskCompleted(${index})">Mark as Completed</button>
                        </li>`;
                    }else 
                        userPastTasks.innerHTML += `<li>${task.description} - ${task.status}</li>`;
                }
            });
        }

        function markTaskCompleted(taskIndex) {
            tasks[taskIndex].status = 'COMPLETED';
            saveData(); 
            updateUserTasks();
        }
        function markTaskClosed(taskIndex) {
            tasks[taskIndex].status = 'CLOSED';
            saveData(); 
            updateTaskLists();
        }

        function addUser() {
            const name = document.getElementById('newUserName').value;
            const role = document.getElementById('userRole').value;
            if (name) {
                users.push({ name, role, manager: null });
                showUserSelection();
                updateAssignLists();
            }

            saveData();
        }

        function assignManager() {
            const executantIndex = document.getElementById('executantList').value;
            const managerIndex = document.getElementById('managerList').value;
            users[executantIndex].manager = users[managerIndex].name;

            saveData();
        }

        function createTask() {
            const description = document.getElementById('taskDescription').value;
            if (description) {
                tasks.push({ description, status: 'OPEN', assignedTo: null });
                updateTaskLists();
            }

            saveData();
        }

        function updateAssignLists() {
            const executantList = document.getElementById('executantList');
            const managerList = document.getElementById('managerList');
            executantList.innerHTML = '';
            managerList.innerHTML = '';
            users.forEach((user, index) => {
                if (user.role === 'executant') executantList.innerHTML += `<option value="${index}">${user.name}</option>`;
                if (user.role === 'manager') managerList.innerHTML += `<option value="${index}">${user.name}</option>`;
            });
        }

        showUserSelection();
		
		window.onload = function() {
			loadData();
			showUserSelection();
		};
    </script>
</body>
</html>
